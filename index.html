<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Tianjinsaçš„åšå®¢ - åˆ†äº«æŠ€æœ¯æ–‡ç« å’Œä¸ªäººå¿ƒå¾—">
    <meta name="keywords" content="Tianjinsa, åšå®¢, æŠ€æœ¯åˆ†äº«, å¼€å‘ç¬”è®°, ç¼–ç¨‹, å‰ç«¯, åç«¯, å…¨æ ˆ">
    <meta name="author" content="Tianjinsa">
    <!-- ç½‘ç«™å›¾æ ‡ -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
    <!-- ç¤¾äº¤åª’ä½“é¢„è§ˆ -->
    <meta property="og:title" content="Tianjinsaçš„åšå®¢">
    <meta property="og:description" content="æŠ€æœ¯åˆ†äº«å’Œä¸ªäººå¿ƒå¾—">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://blog.tianjinsa.top//">
    <title>Tianjinsaçš„åšå®¢</title>
    <!-- å¼•å…¥æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="styles.css">
    <!-- æ·»åŠ ä»£ç é«˜äº® -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css">
    <!-- æ·»åŠ å­—ä½“ -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap">
    <!-- æ·»åŠ å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <a href="index.html" class="navbar-brand">Tianjinsa</a>
        <ul class="navbar-links">
            <li><a href="index.html" class="active"><i class="bi bi-house"></i> é¦–é¡µ</a></li>
            <li><a href="archives.html"><i class="bi bi-archive"></i> å½’æ¡£</a></li>
            <li><a href="tags.html"><i class="bi bi-tags"></i> æ ‡ç­¾</a></li>
            <li><a href="about.html"><i class="bi bi-person"></i> å…³äº</a></li>
        </ul>
        <div class="navbar-toggle" id="navbar-toggle">
            <i class="bi bi-list"></i>
        </div>
    </nav>

    <div class="container">
        <div class="content-wrapper">
            <div class="blog-header">
                <h1>Tianjinsaçš„åšå®¢</h1>
                <p>åˆ†äº«æŠ€æœ¯æ–‡ç« å’Œä¸ªäººå¿ƒå¾—</p>            </div>
            
            <!-- æœç´¢æ  -->
            <div class="search-container">
                <input type="text" id="search-input" class="search-input" placeholder="æœç´¢åšå®¢æ–‡ç« ..." aria-label="æœç´¢åšå®¢æ–‡ç« ">
                <button id="search-btn" class="search-button"><i class="bi bi-search"></i></button>
            </div>
            
            <!-- æ ‡ç­¾ç­›é€‰ -->
            <div id="tags-filter" class="tags-filter">
                <!-- æ ‡ç­¾å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>

            <div id="blog-content">
                <!-- åšå®¢åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                <div class="no-blogs">
                    <p>æ­£åœ¨åŠ è½½åšå®¢å†…å®¹...</p>
                </div>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <footer class="footer">
            <p>&copy; <span id="current-year">2025</span> Tianjinsa. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</p>
            <p>ä½¿ç”¨ <a href="https://pages.github.com/" target="_blank">GitHub Pages</a> æ„å»º</p>
        </footer>
    </div>
    
    <!-- ä»£ç é«˜äº® -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function() {
            const blogContentEl = document.getElementById('blog-content');
            const searchInputEl = document.getElementById('search-input');
            const searchBtnEl = document.getElementById('search-btn');
            const tagsFilterEl = document.getElementById('tags-filter');
            const navbarToggleEl = document.getElementById('navbar-toggle');
            const navbarLinksEl = document.querySelector('.navbar-links');
            
            // è®¾ç½®å½“å‰å¹´ä»½
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // ç§»åŠ¨ç«¯å¯¼èˆªèœå•åˆ‡æ¢
            if (navbarToggleEl && navbarLinksEl) {
                navbarToggleEl.addEventListener('click', function() {
                    navbarLinksEl.classList.toggle('active');
                });
            }
            
            const repoOwner = 'tianjinsa';
            const repoName = 'blog';
            const blogPath = '_posts';
            
            // å­˜å‚¨æ‰€æœ‰åšå®¢æ–‡ç« å’Œæ ‡ç­¾
            let allBlogPosts = [];
            let allTags = new Set();
            let activeTag = null;
            
            // ä»GitHubè·å–åšå®¢æ–‡ä»¶åˆ—è¡¨
            fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${blogPath}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('è·å–åšå®¢åˆ—è¡¨å¤±è´¥');
                    }
                    return response.json();
                })
                .then(files => {
                    // è¿‡æ»¤å‡º.mdæ–‡ä»¶å¹¶æŒ‰æ—¥æœŸæ’åº
                    const blogFiles = files
                        .filter(file => file.name.endsWith('.md'))
                        .sort((a, b) => {
                            // å‡è®¾æ–‡ä»¶åæ ¼å¼ä¸º: YYYY-MM-DD-title.md
                            const dateA = a.name.substring(0, 10);
                            const dateB = b.name.substring(0, 10);
                            return dateB.localeCompare(dateA); // é™åºæ’åˆ—
                        });
                    
                    if (blogFiles.length === 0) {
                        blogContentEl.innerHTML = `
                            <div class="no-blogs">
                                <p>æš‚æ— åšå®¢æ–‡ç« </p>
                            </div>
                        `;
                        return;
                    }
                    
                    // å¤„ç†æ¯ä¸ªåšå®¢æ–‡ä»¶
                    const fetchPromises = blogFiles.map(file => {
                        return fetch(file.download_url)
                            .then(response => response.text())
                            .then(content => {
                                // è§£æfrontmatterå’Œå†…å®¹
                                const frontmatterMatch = content.match(/^---\n([\s\S]*?)\n---\n/);
                                let title = file.name.replace(/^\d{4}-\d{2}-\d{2}-/, '').replace('.md', '');
                                let date = file.name.substring(0, 10);
                                let excerpt = '';
                                let tags = [];                                
                                if (frontmatterMatch) {
                                    const frontmatter = frontmatterMatch[1];
                                    const titleMatch = frontmatter.match(/title:\s*"(.+?)"/);
                                    const dateMatch = frontmatter.match(/date:\s*"(.+?)"/);
                                    const tagsMatch = frontmatter.match(/tags:\s*\[(.*?)\]/);
                                    
                                    if (titleMatch) title = titleMatch[1];
                                    if (dateMatch) {
                                        const dateObj = new Date(dateMatch[1]);
                                        date = dateObj.toLocaleDateString('zh-CN', {
                                            year: 'numeric',
                                            month: 'long',
                                            day: 'numeric'
                                        });
                                    }
                                    
                                    // è§£ææ ‡ç­¾
                                    if (tagsMatch) {
                                        tags = tagsMatch[1].split(',')
                                            .map(tag => tag.trim().replace(/["']/g, ''))
                                            .filter(tag => tag);
                                        
                                        // æ·»åŠ åˆ°å…¨å±€æ ‡ç­¾é›†åˆ
                                        tags.forEach(tag => allTags.add(tag));
                                    }
                                    
                                    // æå–æ­£æ–‡çš„å‰150ä¸ªå­—ç¬¦ä½œä¸ºæ‘˜è¦
                                    const mainContent = content.replace(frontmatterMatch[0], '').trim();
                                    excerpt = mainContent.substring(0, 150) + (mainContent.length > 150 ? '...' : '');
                                }
                                
                                // åˆ›å»ºåšå®¢é“¾æ¥é¡µé¢åœ°å€ï¼Œä½¿ç”¨æ–‡ä»¶åä½œä¸ºé“¾æ¥
                                const blogUrl = `./posts/${file.name.replace('.md', '.html')}`;
                                
                                // ä¿å­˜åšå®¢ä¿¡æ¯
                                const postData = {
                                    title,
                                    date,
                                    displayDate: date,
                                    excerpt,
                                    tags,
                                    url: blogUrl,
                                    fileName: file.name
                                };
                                
                                allBlogPosts.push(postData);
                                
                                // è¿”å›HTMLç‰‡æ®µ
                                return generateBlogCard(postData);                            })
                            .catch(error => {
                                console.error(`åŠ è½½åšå®¢ ${file.name} å¤±è´¥:`, error);
                                return `
                                    <div class="blog-card">
                                        <div class="blog-card-content">
                                            <h2 class="blog-card-title">${file.name}</h2>
                                            <p class="blog-card-excerpt">åŠ è½½åšå®¢å†…å®¹å¤±è´¥</p>
                                        </div>
                                    </div>
                                `;
                            });
                    });
                    
                    // å¤„ç†æ‰€æœ‰åšå®¢å†…å®¹åŠ è½½å®Œæˆåçš„æ“ä½œ
                    Promise.all(fetchPromises)
                        .then(blogItems => {
                            blogContentEl.innerHTML = blogItems.join('');
                            
                            // ç”Ÿæˆæ ‡ç­¾è¿‡æ»¤å™¨
                            generateTagsFilter();
                            
                            // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
                            initSearch();
                            
                            // åˆå§‹åŒ–ä»£ç é«˜äº®
                            if (typeof Prism !== 'undefined') {
                                Prism.highlightAll();
                            }
                        })
                        .catch(error => {
                            console.error('åŠ è½½åšå®¢å†…å®¹å¤±è´¥:', error);
                            blogContentEl.innerHTML = `
                                <div class="no-blogs">
                                    <p>åŠ è½½åšå®¢å†…å®¹å‡ºé”™</p>
                                </div>
                            `;
                        });
                })
                .catch(error => {
                    console.error('è·å–åšå®¢åˆ—è¡¨å¤±è´¥:', error);
                    blogContentEl.innerHTML = `
                        <div class="no-blogs">
                            <p>è·å–åšå®¢åˆ—è¡¨å¤±è´¥: ${error.message}</p>
                        </div>
                    `;
                });
                
            // ç”Ÿæˆæ ‡ç­¾è¿‡æ»¤å™¨
            function generateTagsFilter() {
                if (allTags.size === 0) {
                    tagsFilterEl.style.display = 'none';
                    return;
                }
                
                let tagsHTML = `<div class="tags-heading">æŒ‰æ ‡ç­¾ç­›é€‰:</div><div class="tags-list">`;
                tagsHTML += `<span class="tag active" data-tag="all">å…¨éƒ¨</span>`;
                
                Array.from(allTags).sort().forEach(tag => {
                    tagsHTML += `<span class="tag" data-tag="${tag}">${tag}</span>`;
                });
                
                tagsHTML += `</div>`;
                tagsFilterEl.innerHTML = tagsHTML;
                
                // æ·»åŠ æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('#tags-filter .tag').forEach(tagEl => {
                    tagEl.addEventListener('click', function() {
                        // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeç±»
                        document.querySelectorAll('#tags-filter .tag').forEach(el => {
                            el.classList.remove('active');
                        });
                        
                        // æ·»åŠ å½“å‰æ ‡ç­¾çš„activeç±»
                        this.classList.add('active');
                        
                        // è¿‡æ»¤åšå®¢æ–‡ç« 
                        const selectedTag = this.getAttribute('data-tag');
                        filterBlogsByTag(selectedTag);
                    });
                });
            }
            
            // æ ¹æ®æ ‡ç­¾ç­›é€‰åšå®¢æ–‡ç« 
            function filterBlogsByTag(tag) {
                if (tag === 'all') {
                    // æ˜¾ç¤ºæ‰€æœ‰æ–‡ç« 
                    activeTag = null;
                    renderBlogPosts(allBlogPosts);
                } else {
                    // ç­›é€‰æœ‰ç‰¹å®šæ ‡ç­¾çš„æ–‡ç« 
                    activeTag = tag;
                    const filteredPosts = allBlogPosts.filter(post => {
                        return post.tags.includes(tag);
                    });
                    renderBlogPosts(filteredPosts);
                }
            }
            
            // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
            function initSearch() {
                // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                searchBtnEl.addEventListener('click', performSearch);
                
                // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
                searchInputEl.addEventListener('keyup', function(event) {
                    if (event.key === 'Enter') {
                        performSearch();
                    }
                });
            }
            
            // æ‰§è¡Œæœç´¢
            function performSearch() {
                const searchTerm = searchInputEl.value.trim().toLowerCase();
                
                if (searchTerm === '') {
                    // å¦‚æœæœç´¢è¯ä¸ºç©ºï¼Œæ¢å¤æ˜¾ç¤ºï¼ˆè€ƒè™‘å½“å‰æ¿€æ´»çš„æ ‡ç­¾ï¼‰
                    if (activeTag) {
                        filterBlogsByTag(activeTag);
                    } else {
                        renderBlogPosts(allBlogPosts);
                    }
                    return;
                }
                
                // æ ¹æ®æœç´¢è¯è¿‡æ»¤åšå®¢
                const filteredPosts = allBlogPosts.filter(post => {
                    // å¦‚æœæœ‰æ¿€æ´»çš„æ ‡ç­¾ï¼Œåˆ™åªåœ¨è¯¥æ ‡ç­¾çš„æ–‡ç« ä¸­æœç´¢
                    if (activeTag && !post.tags.includes(activeTag)) {
                        return false;
                    }
                    
                    // æœç´¢æ ‡é¢˜ã€æ‘˜è¦å’Œæ ‡ç­¾
                    return post.title.toLowerCase().includes(searchTerm) || 
                           post.excerpt.toLowerCase().includes(searchTerm) || 
                           post.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                });
                
                renderBlogPosts(filteredPosts);
            }
            
            // æ¸²æŸ“åšå®¢æ–‡ç« åˆ—è¡¨
            function renderBlogPosts(posts) {
                if (posts.length === 0) {
                    blogContentEl.innerHTML = `
                        <div class="no-blogs">
                            <p>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« </p>
                        </div>
                    `;
                    return;
                }
                
                blogContentEl.innerHTML = posts.map(generateBlogCard).join('');
                
                // é‡æ–°åº”ç”¨ä»£ç é«˜äº®
                if (typeof Prism !== 'undefined') {
                    Prism.highlightAll();
                }
            }
            
            // ç”Ÿæˆåšå®¢å¡ç‰‡HTML
            function generateBlogCard(post) {
                const tagsHTML = post.tags.length > 0 
                    ? `<div class="blog-tags">
                        ${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                       </div>` 
                    : '';
                
                return `
                    <div class="blog-card">
                        <div class="blog-card-content">
                            <h2 class="blog-card-title">
                                <a href="${post.url}">${post.title}</a>
                            </h2>
                            <div class="blog-card-meta">
                                <span><i class="bi bi-calendar"></i> ${post.displayDate}</span>
                                ${tagsHTML}
                            </div>
                            <p class="blog-card-excerpt">${post.excerpt}</p>
                            <div class="blog-card-footer">
                                <a href="${post.url}" class="read-more">é˜…è¯»å…¨æ–‡ â†’</a>
                            </div>
                        </div>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>
